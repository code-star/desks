api-version: 2019-12-01
location: westeurope
name: smartdesk-api-with-ssl
properties:
  imageRegistryCredentials:
    - server: codestarsmartdesk.azurecr.io
      username: codestarsmartdesk
      password: ${ACR_PASSWORD}
  containers:
  - name: caddy
    properties:
      image: caddy
      command:
      - caddy
      - reverse-proxy
      - --from
      - ordina-smartdesk-api.westeurope.azurecontainer.io 
      - --to
      - 127.0.0.1:3001
      ports:
        - port: 80
          protocol: TCP
        - port: 443
          protocol: TCP
      resources:
        requests:
          cpu: 1.0
          memoryInGB: 1.5
      volumeMounts:
      - name: caddy-config
        mountPath: /config
      - name: caddy-data
        mountPath: /data
  # - name: nginx-with-ssl
  #   properties:
  #     image: mcr.microsoft.com/oss/nginx/nginx:1.15.5-alpine
  #     ports:
  #     - port: 443
  #       protocol: TCP
  #     resources:
  #       requests:
  #         cpu: 1.0
  #         memoryInGB: 1.5
  #     volumeMounts:
  #     - name: nginx-config
  #       mountPath: /etc/nginx
  - name: smartdesk-api
    properties:
      image: codestarsmartdesk.azurecr.io/smartdesk-api:v1
      ports:
      - port: 3001
        protocol: TCP
      resources:
        requests:
          cpu: 1.0
          memoryInGB: 1.5
      volumeMounts:
      - name: smartdeskvolume
        mountPath: /home/node/code/db/
  volumes:
  - name: smartdeskvolume
    azureFile:
      shareName: volume
      storageAccountName: sasmartdesk
      storageAccountKey: ${STORAGE_ACCOUNT_KEY}
  - name: caddy-config
    azureFile:
      shareName: caddy-config
      storageAccountName: sasmartdesk
      storageAccountKey: ${STORAGE_ACCOUNT_KEY}
  - name: caddy-data
    azureFile:
      shareName: caddy-data
      storageAccountName: sasmartdesk
      storageAccountKey: ${STORAGE_ACCOUNT_KEY}
  - name: nginx-config
    secret:
      ssl.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURMRENDQWhRQ0NRQ2dNNERMWE9aRTZUQU5CZ2txaGtpRzl3MEJBUVVGQURCWU1Rc3dDUVlEVlFRR0V3Sk8KVERFUk1BOEdBMVVFQ2d3SVEyOWtaWE4wWVhJeE5qQTBCZ05WQkFNTUxXOXlaR2x1WVMxemJXRnlkR1JsYzJzdQpkMlZ6ZEdWMWNtOXdaUzVoZW5WeVpXTnZiblJoYVc1bGNpNXBiekFlRncweU1URXlNRGN4TWpRek1EWmFGdzB5Ck1qRXlNRGN4TWpRek1EWmFNRmd4Q3pBSkJnTlZCQVlUQWs1TU1SRXdEd1lEVlFRS0RBaERiMlJsYzNSaGNqRTIKTURRR0ExVUVBd3d0YjNKa2FXNWhMWE50WVhKMFpHVnpheTUzWlhOMFpYVnliM0JsTG1GNmRYSmxZMjl1ZEdGcApibVZ5TG1sdk1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBcENSMXpyYkg5YjhLCk5yRHhsMndMWGdmRmJmeVR0Mm92a1lwUDVDUGhpL3p5aTBUaHZBM3preVRkOXhEc0tGRGRKalM5VWFjWnNUeFMKdDBUcUwxTEY4SWgwTjROUERiWDNPZC9WdXJwcnVGTzFrTC8vQU83eUtUZTlCVmZYVDQ3ZGhYc3dhV1NnLzhMZQpTOXhTV05BMm92MXNLNUFuYmloSnhlSUkrVXJIUUtNeUdOUTNtWXpNZ21PenFrMWtXaWFOMFFPWTlrVkllZHBWCi9URVJpUEFmMkp2dWJyTlQrVFkwOUVXelo1U2RYZHRodFMvMWQvQjdNNGFCTkZMODJpcXFoZi9abkxsdTFDeTUKTUhqcy8yMHZSTndiWjBVWWRqdGtYUzJBSXFrcWR4bVMrZ01CR2V4RkVUNkE1OUhYNklDV2N5THhsQmdUc3pEdgoxSHZWRE9rZ0J3SURBUUFCTUEwR0NTcUdTSWIzRFFFQkJRVUFBNElCQVFBaEZYVWJLcHNjMGw5ZkxaajVmN2pGCnZ3dDhTUFgrZ012dlhKYWl1ekd2VlBTU1FTQmVXUTl2ODJ6SW5sTy9GL2Qrbk51Z0F3dm9MdkdDc0crTnl5T1cKN2N4NE4zVUZWOGl5cXdhaHovZW9NSysvTmZFNXAyT0l4aUxKa3NsZ1l3ZS9vTnFYbHRnQWdKU1JMQVVWQlRpTwpjalU5Yk14OTVZbWRQamQ2S2RvblNmQThEWTVEclQxN25YS3NZWkpOa1R4SEtIMzg2UG1yRXkrTU9ycUZiWXJiCm9JcGhPMEFrQVhoVGtJWURUWElkK2dZWmdyZkhuZ2habzRxbWlMditjUGo1RHpmV3Jtc2l4U0xNcEwydi93ZDQKdFAvRkVna2gxT2hBRk9zM2w4Ukh5WERJT0JTcEV5bVVHeEZaOEEvNUx2ZEQwUHFpa0p5TmFvUXB6SER5bUVaSQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
      ssl.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2QUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktZd2dnU2lBZ0VBQW9JQkFRQ2tKSFhPdHNmMXZ3bzIKc1BHWGJBdGVCOFZ0L0pPM2FpK1Jpay9rSStHTC9QS0xST0c4RGZPVEpOMzNFT3dvVU4wbU5MMVJweG14UEZLMwpST292VXNYd2lIUTNnMDhOdGZjNTM5VzZ1bXU0VTdXUXYvOEE3dklwTjcwRlY5ZFBqdDJGZXpCcFpLRC93dDVMCjNGSlkwRGFpL1d3cmtDZHVLRW5GNGdqNVNzZEFveklZMURlWmpNeUNZN09xVFdSYUpvM1JBNWoyUlVoNTJsWDkKTVJHSThCL1ltKzV1czFQNU5qVDBSYk5ubEoxZDIyRzFML1YzOEhzemhvRTBVdnphS3FxRi85bWN1VzdVTExrdwplT3ovYlM5RTNCdG5SUmgyTzJSZExZQWlxU3AzR1pMNkF3RVo3RVVSUG9EbjBkZm9nSlp6SXZHVUdCT3pNTy9VCmU5VU02U0FIQWdNQkFBRUNnZ0VBYzdsVTZZbUtUdU1DazI2SzFlUVIyNWlGQkRkSCtjOCtmRkRVWkpjN2hGT3cKdUttMnNMdnhWM050bnF2cW83M25QUEYvN0Zwd1RibW00NWtOdHBHWUJpNWVLV2xGU2ZoWnRnN3VnN2k5QzNiUgpFcDJhYnBFSVlERHc3aHh4SzZFZzR1UG9UTlhxZ0lkbDdId0gvcC9GZFlKUVNpSlcrbDRqTFFWZ3FFbWxVeGJhCnd3N1hnYnpjc0ZiVHpONWNFQ3NsV0czODgvaUx2emhoMTYrY3lqUVJkUHpLY0QraStlRnpCRllaL1Z4RC9ha1EKTlNDSmZxSkRMRVVGdDBpcVJEdGlQTGNDTU9qNHFIZkNOeGJqY3NZdkJxRCtsS0JXK3BIMkQ5OVAwU2xjL3JkcApEMllQTW8vcTNpSzJBTXpDMHdOTExKblVScDdRemp4ZzV1RGxDUDA4b1FLQmdRRE95R0VEbnBVOFh1eXFiWHAxCnJVdXVLN0JudGtWVnJDb094RW1ZditpWnlWY1pLdXNrTHdoaEo2OGlDZlVKSzBOODl1WDl4dDJLWGVYNmFoa0oKamJGcFRIUWs5NWpvVW1pVlpqZmJzZWNNSDJ1SUlQeU9WSjBxdG9yNi9GWnFiYUZsMVlCOEJlUU8xZFZCWDFsSQpIR2oyZ2ZiQi9MUVpHRnpPTWVrY2tTNnlzUUtCZ1FETE5lOXNqcFkyc1BDQUVTTFNVTjFObFZFSTlhTThIMTh4Ck9IRVo5R1BzeG0veWM3bEduL3hORi9NaHNEV0NWZHZGY0RQQjl0cExwWE43YkxTcUdRM1EyMW1SNkFpV1VwcFkKQlh6RGh0di8rMGdpUXREQUEzQnNlRFFDc0pwSjNrTWRyNFB6bDNnbWRxUkZTQVR4c0VHTEdXV1V0WUlpTnJkQwpTaHZTU1VOOE53S0JnRFRBZTdkZnFuUzNScXNIdU5qeWQ3OGNHQ210SHkwRytjZkFuWUhoVzJaNExjY1c0dHZkClA4Y0JSN1ZvVXVHZTd0MmZZdmNGMTVpbjhiYWJnSDJtYng4TXlRaHhQY251MUExaEFWa0Rub3pDS3oyVUpMbnUKcmhXcWNmUXJrYVFmQ2JDZjhlSXg0b2RDVitBUWdnZGFjQkNMQVRkbHoxQWpuZkZnWERiVWR0UlJBb0dBSzI1NApvSlFOQ04xaVdZelFDM0ZiQ3pUcG4rZVlIc1o1dXZSY1AvYmEwSVZNOGQzSDhJOUxCbE1qRk1VcmVwTE5LUEtsCkxVU01QWFM4TE5uNzl3cnB5QVRKclFTUnFVYzRVNjNBajYyb0lacmNQTzVZM1dFZXl5QVp4YVZuSkhpTGtiR3MKbXdoNWxvYnU3eHZJYXJ1SUZxbXo2MGVyNjVJVU11ZlI4R3pXTHBzQ2dZQkFiUzJZSlo3Q1lDdmVKOVAwcTRvcApaMFdYU1RYdFVzQzBacGoxNm9LRDZzNHQ4bG9DRGIxbThncnp0WlgzS0NYOWo2WTBEaVhYOFdpQ0ZBVFNGZUVCCjU3NzN5TE9RUEFITUUzNlhuUUZpcHVTM3lUd09WZlR4dHZpUlF4S1U4WjlqME9QVDhkNzMyV1FIQmNOTXByK2MKditJUC82QjRndEJlWkhaUEJaRlFUQT09Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K
      nginx.conf: IyBuZ2lueCBDb25maWd1cmF0aW9uIEZpbGUKIyBodHRwczovL3dpa2kubmdpbngub3JnL0NvbmZpZ3VyYXRpb24KCiMgUnVuIGFzIGEgbGVzcyBwcml2aWxlZ2VkIHVzZXIgZm9yIHNlY3VyaXR5IHJlYXNvbnMuCnVzZXIgbmdpbng7Cgp3b3JrZXJfcHJvY2Vzc2VzIGF1dG87CgpldmVudHMgewogIHdvcmtlcl9jb25uZWN0aW9ucyAxMDI0Owp9CgpwaWQgICAgICAgIC92YXIvcnVuL25naW54LnBpZDsKCmh0dHAgewoKICAgICNSZWRpcmVjdCB0byBodHRwcywgdXNpbmcgMzA3IGluc3RlYWQgb2YgMzAxIHRvIHByZXNlcnZlIHBvc3QgZGF0YQoKICAgIHNlcnZlciB7CiAgICAgICAgbGlzdGVuIFs6Ol06NDQzIHNzbDsKICAgICAgICBsaXN0ZW4gNDQzIHNzbDsKCiAgICAgICAgc2VydmVyX25hbWUgbG9jYWxob3N0OwoKICAgICAgICAjIFByb3RlY3QgYWdhaW5zdCB0aGUgQkVBU1QgYXR0YWNrIGJ5IG5vdCB1c2luZyBTU0x2MyBhdCBhbGwuIElmIHlvdSBuZWVkIHRvIHN1cHBvcnQgb2xkZXIgYnJvd3NlcnMgKElFNikgeW91IG1heSBuZWVkIHRvIGFkZAogICAgICAgICMgU1NMdjMgdG8gdGhlIGxpc3Qgb2YgcHJvdG9jb2xzIGJlbG93LgogICAgICAgIHNzbF9wcm90b2NvbHMgICAgICAgICAgICAgIFRMU3YxLjI7CgogICAgICAgICMgQ2lwaGVycyBzZXQgdG8gYmVzdCBhbGxvdyBwcm90ZWN0aW9uIGZyb20gQmVhc3QsIHdoaWxlIHByb3ZpZGluZyBmb3J3YXJkaW5nIHNlY3JlY3ksIGFzIGRlZmluZWQgYnkgTW96aWxsYSAtIGh0dHBzOi8vd2lraS5tb3ppbGxhLm9yZy9TZWN1cml0eS9TZXJ2ZXJfU2lkZV9UTFMjTmdpbngKICAgICAgICBzc2xfY2lwaGVycyAgICAgICAgICAgICAgICBFQ0RIRS1SU0EtQUVTMTI4LUdDTS1TSEEyNTY6RUNESEUtRUNEU0EtQUVTMTI4LUdDTS1TSEEyNTY6RUNESEUtUlNBLUFFUzI1Ni1HQ00tU0hBMzg0OkVDREhFLUVDRFNBLUFFUzI1Ni1HQ00tU0hBMzg0OkRIRS1SU0EtQUVTMTI4LUdDTS1TSEEyNTY6REhFLURTUy1BRVMxMjgtR0NNLVNIQTI1NjprRURIK0FFU0dDTTpFQ0RIRS1SU0EtQUVTMTI4LVNIQTI1NjpFQ0RIRS1FQ0RTQS1BRVMxMjgtU0hBMjU2OkVDREhFLVJTQS1BRVMxMjgtU0hBOkVDREhFLUVDRFNBLUFFUzEyOC1TSEE6RUNESEUtUlNBLUFFUzI1Ni1TSEEzODQ6RUNESEUtRUNEU0EtQUVTMjU2LVNIQTM4NDpFQ0RIRS1SU0EtQUVTMjU2LVNIQTpFQ0RIRS1FQ0RTQS1BRVMyNTYtU0hBOkRIRS1SU0EtQUVTMTI4LVNIQTI1NjpESEUtUlNBLUFFUzEyOC1TSEE6REhFLURTUy1BRVMxMjgtU0hBMjU2OkRIRS1SU0EtQUVTMjU2LVNIQTI1NjpESEUtRFNTLUFFUzI1Ni1TSEE6REhFLVJTQS1BRVMyNTYtU0hBOkFFUzEyOC1HQ00tU0hBMjU2OkFFUzI1Ni1HQ00tU0hBMzg0OkVDREhFLVJTQS1SQzQtU0hBOkVDREhFLUVDRFNBLVJDNC1TSEE6QUVTMTI4OkFFUzI1NjpSQzQtU0hBOkhJR0g6IWFOVUxMOiFlTlVMTDohRVhQT1JUOiFERVM6ITNERVM6IU1ENTohUFNLOwogICAgICAgIHNzbF9wcmVmZXJfc2VydmVyX2NpcGhlcnMgIG9uOwoKICAgICAgICAjIE9wdGltaXplIFRMUy9TU0wgYnkgY2FjaGluZyBzZXNzaW9uIHBhcmFtZXRlcnMgZm9yIDEwIG1pbnV0ZXMuIFRoaXMgY3V0cyBkb3duIG9uIHRoZSBudW1iZXIgb2YgZXhwZW5zaXZlIFRMUy9TU0wgaGFuZHNoYWtlcy4KICAgICAgICAjIFRoZSBoYW5kc2hha2UgaXMgdGhlIG1vc3QgQ1BVLWludGVuc2l2ZSBvcGVyYXRpb24sIGFuZCBieSBkZWZhdWx0IGl0IGlzIHJlLW5lZ290aWF0ZWQgb24gZXZlcnkgbmV3L3BhcmFsbGVsIGNvbm5lY3Rpb24uCiAgICAgICAgIyBCeSBlbmFibGluZyBhIGNhY2hlIChvZiB0eXBlICJzaGFyZWQgYmV0d2VlbiBhbGwgTmdpbnggd29ya2VycyIpLCB3ZSB0ZWxsIHRoZSBjbGllbnQgdG8gcmUtdXNlIHRoZSBhbHJlYWR5IG5lZ290aWF0ZWQgc3RhdGUuCiAgICAgICAgIyBGdXJ0aGVyIG9wdGltaXphdGlvbiBjYW4gYmUgYWNoaWV2ZWQgYnkgcmFpc2luZyBrZWVwYWxpdmVfdGltZW91dCwgYnV0IHRoYXQgc2hvdWxkbid0IGJlIGRvbmUgdW5sZXNzIHlvdSBzZXJ2ZSBwcmltYXJpbHkgSFRUUFMuCiAgICAgICAgc3NsX3Nlc3Npb25fY2FjaGUgICAgc2hhcmVkOlNTTDoxMG07ICMgYSAxbWIgY2FjaGUgY2FuIGhvbGQgYWJvdXQgNDAwMCBzZXNzaW9ucywgc28gd2UgY2FuIGhvbGQgNDAwMDAgc2Vzc2lvbnMKICAgICAgICBzc2xfc2Vzc2lvbl90aW1lb3V0ICAyNGg7CgoKICAgICAgICAjIFVzZSBhIGhpZ2hlciBrZWVwYWxpdmUgdGltZW91dCB0byByZWR1Y2UgdGhlIG5lZWQgZm9yIHJlcGVhdGVkIGhhbmRzaGFrZXMKICAgICAgICBrZWVwYWxpdmVfdGltZW91dCAzMDA7ICMgdXAgZnJvbSA3NSBzZWNzIGRlZmF1bHQKCiAgICAgICAgIyByZW1lbWJlciB0aGUgY2VydGlmaWNhdGUgZm9yIGEgeWVhciBhbmQgYXV0b21hdGljYWxseSBjb25uZWN0IHRvIEhUVFBTCiAgICAgICAgYWRkX2hlYWRlciBTdHJpY3QtVHJhbnNwb3J0LVNlY3VyaXR5ICdtYXgtYWdlPTMxNTM2MDAwOyBpbmNsdWRlU3ViRG9tYWlucyc7CgogICAgICAgIHNzbF9jZXJ0aWZpY2F0ZSAgICAgIC9ldGMvbmdpbngvc3NsLmNydDsKICAgICAgICBzc2xfY2VydGlmaWNhdGVfa2V5ICAvZXRjL25naW54L3NzbC5rZXk7CgogICAgICAgIGxvY2F0aW9uIC8gewogICAgICAgICAgICBwcm94eV9wYXNzIGh0dHA6Ly9sb2NhbGhvc3Q6MzAwMTsgIyBUT0RPOiByZXBsYWNlIHBvcnQgaWYgYXBwIGxpc3RlbnMgb24gcG9ydCBvdGhlciB0aGFuIDgwCgogICAgICAgICAgICBwcm94eV9zZXRfaGVhZGVyIENvbm5lY3Rpb24gIiI7CiAgICAgICAgICAgIHByb3h5X3NldF9oZWFkZXIgSG9zdCAkaG9zdDsKICAgICAgICAgICAgcHJveHlfc2V0X2hlYWRlciBYLVJlYWwtSVAgJHJlbW90ZV9hZGRyOwogICAgICAgICAgICBwcm94eV9zZXRfaGVhZGVyIFgtRm9yd2FyZGVkLUZvciAkcmVtb3RlX2FkZHI7CiAgICAgICAgfQogICAgfQp9
  ipAddress:
    ports:
    - port: 443
      protocol: TCP
    - port: 3001
      protocol: TCP
    type: Public
    dnsNameLabel: ordina-smartdesk
  # query: ipAddress.fqdn
  osType: Linux
tags: null
type: Microsoft.ContainerInstance/containerGroups
